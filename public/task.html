<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <style>
        body {
            display: flex;
            min-height: 100vh;
            margin: 0;
        }
        #content {
            flex: 1;
            padding: 1rem;
        }
    </style>
    <script>
        // Charger dynamiquement la sidebar
        document.addEventListener("DOMContentLoaded", () => {
            fetch('sidebar.html')  // Charge le fichier sidebar.html
                .then(response => response.text()) // Récupère le contenu du fichier
                .then(data => {
                    document.getElementById('sidebar-container').innerHTML = data;  // Insère le contenu de la sidebar dans l'élément 'sidebar-container'
                })
                .catch(error => console.error('Erreur lors du chargement de la sidebar:', error));
        });
    </script>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar-container"></div> <!-- La sidebar sera insérée ici dynamiquement -->

    <!-- Content -->
    <div id="content">
        <header class="bg-blue-600 p-4 text-white mb-4">
            <h1 class="text-2xl">Task Manager</h1>
        </header>
        <form id="addTaskForm" class="space-y-4 bg-white p-4 rounded shadow-md mb-6">
            <input id="taskTitle" type="text" placeholder="Task Title" class="w-full p-2 border rounded" required />
            <textarea id="taskDescription" placeholder="Task Description" class="w-full p-2 border rounded" required></textarea>
            <label for="taskPriority">Priorité:</label>
            <select id="taskPriority" name="taskPriority" class="w-full p-2 border rounded">
                <option value="haute">Haute</option>
                <option value="moyenne">Moyenne</option>
                <option value="basse">Basse</option>
            </select>
            <input id="taskDeadline" type="date" class="w-full p-2 border rounded" required />
            <button type="submit" class="w-full bg-green-500 text-white p-2 rounded">Add Task</button>
            <button type="button" id="updateTaskBtn" class="w-full bg-yellow-500 text-white p-2 rounded hidden">Update Task</button>
        </form>
        <div class="bg-white p-4 rounded shadow-md">
            <h2 class="text-xl font-bold mb-4">Liste des Tâches</h2>
            <table class="min-w-full table-auto border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="px-4 py-2 border">Titre</th>
                        <th class="px-4 py-2 border">Description</th>
                        <th class="px-4 py-2 border">Priorité</th>
                        <th class="px-4 py-2 border">Date Limite</th>
                        <th class="px-4 py-2 border">Actions</th>
                    </tr>
                </thead>
                <tbody id="taskTableBody">
                    <!-- Les lignes des tâches seront insérées ici -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Récupérer les tâches depuis le localStorage
        function getTasks() {
            try {
                return JSON.parse(localStorage.getItem("tasks") || "[]");
            } catch (error) {
                console.error("Erreur lors de la récupération des tâches :", error);
                return [];
            }
        }

        // Sauvegarder une tâche dans le localStorage
        function saveTask(task) {
            const tasks = getTasks();
            tasks.push(task);
            localStorage.setItem("tasks", JSON.stringify(tasks));
        }

        // Sauvegarder toutes les tâches dans le localStorage
        function saveAllTasks(tasks) {
            localStorage.setItem("tasks", JSON.stringify(tasks));
        }

        // Afficher les tâches
        function displayTasks() {
            const tasks = getTasks();
            const taskTableBody = document.getElementById("taskTableBody");

            taskTableBody.innerHTML = ""; // Vider le tableau

            if (tasks.length === 0) {
                taskTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-gray-500">Aucune tâche trouvée.</td>
                    </tr>
                `;
                return;
            }

            // Afficher chaque tâche
            tasks.forEach((task, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td class="px-4 py-2 border">${task.title || "Non défini"}</td>
                    <td class="px-4 py-2 border">${task.description || "Non défini"}</td>
                    <td class="px-4 py-2 border">${task.priority || "Non défini"}</td>
                    <td class="px-4 py-2 border">${task.deadline || "Non défini"}</td>
                    <td class="px-4 py-2 border">
                        <button class="bg-blue-500 text-white px-2 py-1 rounded mr-2" onclick="editTask(${index})">Modifier</button>
                        <button class="bg-red-500 text-white px-2 py-1 rounded" onclick="deleteTask(${index})">Supprimer</button>
                    </td>
                `;
                taskTableBody.appendChild(row);
            });
        }

        // Supprimer une tâche
        function deleteTask(index) {
            const tasks = getTasks();
            tasks.splice(index, 1); // Supprimer la tâche à l'index donné
            saveAllTasks(tasks); // Sauvegarder les tâches restantes
            displayTasks(); // Mettre à jour l'affichage
        }

        // Modifier une tâche
        function editTask(index) {
            const tasks = getTasks();
            const task = tasks[index];

            document.getElementById("taskTitle").value = task.title;
            document.getElementById("taskDescription").value = task.description;
            document.getElementById("taskPriority").value = task.priority;
            document.getElementById("taskDeadline").value = task.deadline;

            document.getElementById("updateTaskBtn").classList.remove("hidden");
            document.getElementById("addTaskForm").querySelector("button[type='submit']").classList.add("hidden");

            document.getElementById("updateTaskBtn").onclick = function () {
                tasks[index] = {
                    title: document.getElementById("taskTitle").value.trim(),
                    description: document.getElementById("taskDescription").value.trim(),
                    priority: document.getElementById("taskPriority").value,
                    deadline: document.getElementById("taskDeadline").value,
                };

                saveAllTasks(tasks);
                displayTasks();

                document.getElementById("addTaskForm").reset();
                document.getElementById("updateTaskBtn").classList.add("hidden");
                document.getElementById("addTaskForm").querySelector("button[type='submit']").classList.remove("hidden");
            };
        }

        // Gérer l'ajout de tâche
        document.getElementById("addTaskForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const title = document.getElementById("taskTitle").value.trim();
            const description = document.getElementById("taskDescription").value.trim();
            const priority = document.getElementById("taskPriority").value;
            const deadline = document.getElementById("taskDeadline").value;

            if (!title || !description || !deadline) {
                alert("Tous les champs sont obligatoires !");
                return;
            }

            const newTask = { title, description, priority, deadline };
            saveTask(newTask);
            displayTasks();

            document.getElementById("addTaskForm").reset();
        });

        // Charger les tâches à l'ouverture de la page
        document.addEventListener("DOMContentLoaded", displayTasks);
    </script>
</body>
</html>